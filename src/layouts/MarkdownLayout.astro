---
import PageLayout from './PageLayout.astro';
import Breadcrumb from '../components/astro/Breadcrumb.astro';
import TableOfContents from '../components/astro/TableOfContents.astro';
import FormattedDate from '../components/astro/FormattedDate.astro';
import ProseEnhancements from '../components/astro/ProseEnhancements.astro';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  date?: Date;
  author?: string;
  tags?: string[];
  keywords?: string;
  headings?: { depth: number; slug: string; text: string }[];
}

const { title, description, ogImage, date, author, tags, keywords, headings = [] } = Astro.props;
const showToc = headings.length > 2;
---

<PageLayout title={title} description={description} ogImage={ogImage} keywords={keywords}>
  <Breadcrumb />

  <article class="mt-4">
    <header class="mb-6 border-b border-surface-200 pb-4 dark:border-dm-border">
      <h1 class="mb-2 font-serif text-2xl font-normal text-surface-900 sm:text-3xl dark:text-dm-heading">
        {title}
      </h1>
      {description && <p class="mb-3 text-surface-500 dark:text-dm-muted">{description}</p>}
      <div class="flex flex-wrap items-center gap-3 text-sm text-surface-400 dark:text-dm-faint">
        {date && <FormattedDate date={date} />}
        {
          author && (
            <>
              <span>&middot;</span>
              <a href={`/people/${author}`} class="text-primary-600 hover:underline dark:text-accent-400">
                {author}
              </a>
            </>
          )
        }
      </div>
      {
        tags && tags.length > 0 && (
          <div class="mt-3 flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="text-xs text-surface-400 dark:text-dm-faint">#{tag}</span>
            ))}
          </div>
        )
      }
    </header>

    <div class={showToc ? 'lg:grid lg:grid-cols-[1fr_200px] lg:gap-8' : ''}>
      <div class="prose">
        <slot />
      </div>
      <ProseEnhancements />

      {
        showToc && (
          <aside class="hidden lg:block">
            <TableOfContents headings={headings} />
          </aside>
        )
      }
    </div>
  </article>
</PageLayout>
